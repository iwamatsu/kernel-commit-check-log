Check from v4.19.36 to v4.19.37
Commit count: 99
checking 19bb613acb9ad8e57593cad5118acaee117cc303 ......
checking cdd369fe0f98c29d01b310f7ee1c89e43eecbd8c ......
	 orig commit -> 9002b21465fa4d829edfc94a5a441005cffaa972 ......
checking ac54bc121e1f491b70d71ac234b8e0f76f79d7ad ......
	 orig commit -> 0e0f7b30721233ce610bde2395a8e58ff7771475 ......
	 orig commit -> 71492580571467fb7177aade19c18ce7486267f5 ......
checking 9c1862566176250bae343a5cee617a5ce41efa54 ......
	 orig commit -> b59dfdaef173677b0b7e10f375226c0a1114fd20 ......
checking 52dde1160f17c42bca85f1365227a69b2c6aa9e8 ......
	 orig commit -> 24d6638302b48328a58c13439276d4531af4ca7d ......
checking a782f8475715d6dc61f892127d4fb8e5f0775ac4 ......
	 orig commit -> ba4aa02b417f08a0bee5e7b8ed70cac788a7c854 ......
checking 6580376fe81093d3a796b7e8b8c3c0f9e620f89c ......
	 orig commit -> 00206a69ee32f03e6f40837684dcbe475ea02266 ......
checking 8a6f2ea0c3dd3de75cc344fe8d216457287a2ab2 ......
	 orig commit -> 8c2f870890fd28e023b0fcf49dcee333f2c8bad7 ......
checking 1343fd8f9629ef1e040bdb84626ae69382272741 ......
	 orig commit -> e8277b3b52240ec1caad8e6df278863e4bf42eac ......
checking 628c99a836dde71a4e415859359b7ebecdb3d363 ......
	 orig commit -> 0fcc4c8c044e117ac126ab6df4138ea9a67fa2a9 ......
checking c3edd427d5389ca46734c343662cdba1b3048f12 ......
	 orig commit -> 2e8e19226398db8265a8e675fcc0118b9e80c9e8 ......
checking c21bcc2352e954202798588c41cd76c43073d207 ......
	 orig commit -> a75bb4eb9e565b9f5115e2e8c07377ce32cbe69a ......
checking 1c36862e8be8e45094024e7384a7b441779f34cb ......
	 orig commit -> b9d0a85d6b2e76630cfd4c475ee3af4109bfd87a ......
checking 18af9b7b91380825ac398ff3b94fac4e0621c5cc ......
	 orig commit -> 442601e87a4769a8daba4976ec3afa5222ca211d ......
checking 7de43cb71116ab13adaf1f57a72edb6757ca57d0 ......
	 orig commit -> f880eea68fe593342fa6e09be9bb661f3c297aec ......
checking aa0e8cc9d7a89bb0c23435ec1b62eac46b1f4984 ......
	 orig commit -> ec91e78d378cc5d4b43805a1227d8e04e5dfa17d ......
checking 87eadc0b8c2a574c3e48aa0d15e1318a6a24f654 ......
	 orig commit -> af849c86109d79222e549826068bbf4e7f9a2472 ......
checking ba8a6c055677ef22c43fd31b6ac0b27998be36f9 ......
	 orig commit -> 869f8a69bb3a4aec4eb914a330d4ba53a9eed495 ......
checking b2be40b73b29921e5c7f2e3a11ceaa31c508326c ......
	 orig commit -> 4bf780996669280171c9cd58196512849b93434e ......
checking be608583d9c4910877d7553d4240e998818c2d70 ......
	 orig commit -> 78153dd45e7e0596ba32b15d02bda08e1513111e ......
checking 40221d56ae28eb0b3e86a482063b0e303903e397 ......
	 orig commit -> 5479b2757f26fe9908fc341d105b2097fe820b6f ......
checking bc18c2593635364f0c71f76f8fc395bee33954ab ......
	 orig commit -> e34b8252a3d2893ca55c82dbfcdaa302fa03d400 ......
checking 82a13a006ed5412fd817419e60113b7c922b21ff ......
	 orig commit -> 317a992ab9266b86b774b9f6b0f87eb4f59879a1 ......
checking cd37fd46b4857a787571c3153bfa64d0ae28a407 ......
	 orig commit -> 3f2552f7e9c5abef2775c53f7af66532f8bf65bc ......
checking 5680b0635cdab1a1afb4f2078226584e008008b0 ......
	 orig commit -> 2f5fb19341883bb6e37da351bc3700489d8506a7 ......
checking 90e17512f1e43a67008082d0380bdc8a689c6c9b ......
	 orig commit -> 9d5dcc93a6ddfc78124f006ccd3637ce070ef2fc ......
checking 293926b37013c0b9204d110eaaad9a4a5467d24b ......
	 orig commit -> 1de7edbb59c8f1b46071f66c5c97b8a59569eb51 ......
checking f45829e6250a84350e38402cc4dc2b5e3a9ea82e ......
	 orig commit -> 3fe3331bb285700ab2253dbb07f8e478fcea2f1b ......
checking ba407222f563af8cfc69c5ae5607899a039f8be2 ......
	 orig commit -> 1925e7d3d4677e681cc2e878c2bdbeaee988c8e2 ......
checking 39cad03c4360b72d4d4adda4be1b718c24d0af44 ......
	 orig commit -> 4856bfd230985e43e84c26473c91028ff0a533bd ......
checking 852de0d53d1443404b00c6e7dc6f15adc68aec1d ......
	 orig commit -> 746ba11f170603bf1eaade817553a6c2e9135bbe ......
checking 23a926e5edd940b7311e0c511caa4b45eaf6b59f ......
	 orig commit -> 5f843ed415581cfad4ef8fefe31c138a8346ca8a ......
checking 426e2a8024c23b3a664250b46e2ab0604c0a0a09 ......
	 orig commit -> fabe38ab6b2bd9418350284c63825f13b8a6abba ......
checking 1fab567a270b8fb2f2b80c00b5c8c8106d377be8 ......
	 orig commit -> 3ff9c075cc767b3060bdac12da72fc94dd7da1b8 ......
checking 5105fc758bdc4f7bb330248f1e2d2ea3b704421d ......
	 orig commit -> ff8acf929014b7f87315588e0daf8597c8aa9d1c ......
checking 96800ba9e565ab752774cd88328f96aed28a1436 ......
	 orig commit -> a66477b0efe511d98dde3e4aaeb189790e6f0a39 ......
checking fbe5cff932295f2468524bf6ffe109a9d0849178 ......
	 orig commit -> 678cce4019d746da6c680c48ba9e6d417803e127 ......
checking dacdbc115d23f1e4dbc091440bd5cdcdc01173b6 ......
	 orig commit -> 3b9a907223d7f6b9d1dadea29436842ae9bcd76d ......
checking 6ff17bc5936e5fab33de8064dc0690f6c8c789ca ......
	 orig commit -> 04f5866e41fb70690e28397487d8bd8eea7d712a ......
checking 3e1b3e4d3c83a925e9c6fcd5aeed8713225b4a37 ......
	 orig commit -> 4a58038b9e420276157785afa0a0bbb4b9bc2265 ......
checking ee4b8e266229b061ff8d03f0ed8764ac5f8098b6 ......
	 orig commit -> 0228034d8e5915b98c33db35a98f5e909e848ae9 ......
checking 1aa2682d0a98bb025f8dd29df11f978a249a81ba ......
	 orig commit -> be549d49115422f846b6d96ee8fd7173a5f7ceb0 ......
checking 8f2ef0e8f9670f83b3fe7e620eb7ae98910ff627 ......
	 orig commit -> b2ecf00631362a83744e5ec249947620db5e240c ......
checking 38b7f09a9e83da3d8d786429520aace041e1d29e ......
	 orig commit -> ace965696da2611af759f0284e26342b7b6cec89 ......
checking de6d6b8902fb2d26a46d266841364c3bfa70dc41 ......
	 orig commit -> 6b87784b53592a90d21576be8eff688b56d93cce ......
checking ec96f65e121459eda46de186750a7e9646306288 ......
	 orig commit -> 738c06d0e4562e0acf9f2c7438a22b2d5afc67aa ......
checking b50e435df2d8b9a1d3e956e1c767dfc7e30a441b ......
	 orig commit -> 2a3f7221acddfe1caa9ff09b3a8158c39b2fdeac ......
checking 4171b6ee932828ad2c8258f4a0a84a2d1c05c896 ......
	 orig commit -> b26e36b7ef36a8a3a147b1609b2505f8a4ecf511 ......
		 b26e36b7ef36a8a3a147b1609b2505f8a4ecf511 has problem. Fixes commit -> 0a29c57b76624723b6b00c027e0e992d130ace49
commit f937634b662650214d845935b5763b358439ab45
Author: Kailang Yang <kailang@realtek.com>
Date:   Wed Apr 24 16:34:25 2019 +0800

    ALSA: hda/realtek - Add new Dell platform for headset mode
    
    commit 0a29c57b76624723b6b00c027e0e992d130ace49 upstream.
    
    Add two Dell platform for headset mode.
    
    [ Note: this is a further correction / addition of the previous
      pin-based quirks for Dell machines; another entry for ALC236 with
      the d-mic pin 0x12 and an entry for ALC295 -- tiwai ]
    
    Fixes: b26e36b7ef36 ("ALSA: hda/realtek - add two more pin configuration sets to quirk table")
    Signed-off-by: Kailang Yang <kailang@realtek.com>
    Cc: <stable@vger.kernel.org>
    Signed-off-by: Takashi Iwai <tiwai@suse.de>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
checking 4e78a1fb8d1d0948aafac07465779e821d9dda2e ......
	 orig commit -> af4b54a2e5ba18259ff9aac445bf546dd60d037e ......
checking 09f9bacae11874c6abe368fab7b093dd33ef11ea ......
	 orig commit -> 660cf4ce9d0f3497cc7456eaa6d74c8b71d6282c ......
checking edf2f548baa959e90f1a2f0fce737e18701070d5 ......
	 orig commit -> 663d294b4768bfd89e529e069bffa544a830b5bf ......
checking 1f01a970b8c2de057c7c1cf3afce3d116fb6645b ......
	 orig commit -> 08b7c2f9208f0e2a32159e4e7a4831b7adb10a3e ......
checking a1da981f66432d1d38c91cff0b19490b3bf7aace ......
	 orig commit -> 131ac62253dba79daf4a6d83ab12293d2b9863d3 ......
		 131ac62253dba79daf4a6d83ab12293d2b9863d3 has problem. Fixes commit -> 3970d0d81816310175b6272e709ee09dd3e05171
checking b007c64d860f55db1064e4e7a56cbbabe87d1cc9 ......
	 orig commit -> fe2d3df639a7940a125a33d6460529b9689c5406 ......
checking bbe0bed4647ccc135a31c378b1257e9af6f9c4e9 ......
	 orig commit -> 7f75591fc5a123929a29636834d1bcb8b5c9fee3 ......
checking 98171e1947b6ce06fb7a439c0d8c599e0c090fcd ......
	 orig commit -> 09c6bdee51183a575bf7546890c8c137a75a2b44 ......
checking 36971130bb2f815fddae17cfe02ae5fed9b3ff56 ......
	 orig commit -> 20ea39ef9f2f911bd01c69519e7d69cfec79fde3 ......
checking 0e47edde91325efde88e937e1ccc5883c32b5a31 ......
	 orig commit -> 06003531502d06bc89d32528f6ec96bf978790f9 ......
checking 5ad173ea6c3a906c80c9e1afb3960c859d9ab037 ......
	 orig commit -> fccfb9ce70ed4ea7a145f77b86de62e38178517f ......
checking 42eae0cff22a75823abfe198fce4418461b7cc6b ......
	 orig commit -> 3d02d7082e5823598090530c3988a35f69689943 ......
checking adfb0f0b17a3b1bdef44a5249def720534d7ac33 ......
	 orig commit -> 73f3bc6da506711302bb67572440eb84b1ec4a2c ......
checking a3117576a73f6b2df88d96fb6ae0402bba0c24b3 ......
	 orig commit -> 9436f45dd53595e21566a8c6627411077dfdb776 ......
checking f7ee6890caa59f71c4af92814afd4b4cb7dafcc9 ......
	 orig commit -> 40a7198a4a01037003c7ca714f0d048a61e729ac ......
checking 8bd3fd46ec23375740e7f29bafce4a11f6cff1d2 ......
	 orig commit -> 409a51e0a4a5f908763191fae2c29008632eb712 ......
checking 6f3e66b155f02dd90a30c9307f4900256eafa3f1 ......
	 orig commit -> 7ce0f216221856a17fc4934b39284678a5fef2e9 ......
checking c54d1258c637ac4318cab995be0965b866cb8e3b ......
	 orig commit -> 0a8a29be499cbb67df79370aaf5109085509feb8 ......
checking c9e34935a3514d083cc2787f874fee786c775c6c ......
	 orig commit -> 99c221796a810055974b54c02e8f53297e48d146 ......
checking 18cf09a817714d7702f4dfa0956abefd4b4e2f63 ......
	 orig commit -> 8f4dc2e77cdfaf7e644ef29693fa229db29ee1de ......
checking 2fcee5eaae6ee1c2ccbe629ffd46c6674a98824c ......
	 orig commit -> e6d0fb7b34f264f72c33053558a360a6a734905e ......
checking c69330a855ab4342d304f67f8c1e7d1fa2686bec ......
	 orig commit -> 088aaf17aa79300cab14dbee2569c58cfafd7d6e ......
checking 8fb89b43b65fcd35f15d982712904b96fc64c68a ......
	 orig commit -> 6a3eb3360667170988f8a6477f6686242061488a ......
checking 8092ecc306d81186a64cda42411121f4d35aaff4 ......
	 orig commit -> b98749cac4a695f084a5ff076f4510b23e353ecd ......
checking 6e2081f29392f878aa9e1bd19b976c7c8b82bad3 ......
	 orig commit -> 997dd96471641e147cb2c33ad54284000d0f5e35 ......
checking 684685326ab0cf8d71ae83ff614c748876f24938 ......
	 orig commit -> d4289fcc9b16b89619ee1c54f829e05e56de8b9a ......
		 d4289fcc9b16b89619ee1c54f829e05e56de8b9a has problem. Fixes commit -> 47d3d7fdb10a21c223036b58bd70ffdc24a472c4
checking 702ddf862d9d74e670849df659b8706fd6878205 ......
	 orig commit -> c23f35d19db3b36ffb9e04b08f1d91565d15f84f ......
checking e24be8e38cd7fcc85174595690b20d153f8e204d ......
	 orig commit -> 4976e3c683f328bc6f2edef555a4ffee6524486f ......
checking 8d9051a4680abf7316b440278fe52b9437503e90 ......
	 orig commit -> 42cd5484a22f1a1b947e21e2af65fa7dab09d017 ......
checking 06f7d2182f9d850e762a8870633d10e99cfc10a8 ......
	 orig commit -> f7ee799a51ddbcc205ef615fe424fb5084e9e0aa ......
checking cbce0413f783a5a9d49005a2187201df8eb15a38 ......
	 orig commit -> c87b4ecdbe8db27867a7b7f840291cd843406bd7 ......
checking 490532225e20f2c3ef763c7da2c4e090ac42318a ......
	 orig commit -> b2100cc56fca8c51d28aa42a9f1fbcb2cf351996 ......
checking 5f72cb2ab51d242158b6b963365d70f88844b983 ......
	 orig commit -> 9c69a13205151c0d801de9f9d83a818e6e8f60ec ......
checking 1d2499b0860024c7cd973a8dee375105ffd34156 ......
	 orig commit -> df3a8344d404a810b4aadbf19b08c8232fbaa715 ......
checking 785833b9eee027c0d31dfe96225e243f13110939 ......
	 orig commit -> b4f47f3848eb70986f75d06112af7b48b7f5f462 ......
checking 7cfddb81a81727362e0e4d3aea03af7d7d96d73f ......
	 orig commit -> 31634bf5dcc418b5b2cacd954394c0c4620db6a2 ......
checking d1785bea2f3419507827b009b483a53fde80b928 ......
	 orig commit -> 1f227d16083b2e280b7dde4ca78883d75593f2fd ......
checking 9de22b997fe40a0f783db73df5574d20242c6f09 ......
	 orig commit -> 5ee15c101f29e0093ffb5448773ccbc786eb313b ......
checking 7ba5ec69e1a7ecfc662050b55e77078208dea9cc ......
	 orig commit -> c543cb4a5f07e09237ec0fc2c60c9f131b2c79ad ......
checking 8a430e56a6485267a1b2d3747209d26c54d1a34b ......
	 orig commit -> ed0de45a1008991fdaa27a0152befcb74d126a8b ......
		 ed0de45a1008991fdaa27a0152befcb74d126a8b has problem. Fixes commit -> 20ff83f10f113c88d0bb74589389b05250994c16
c543cb4a5f07e09237ec0fc2c60c9f131b2c79ad
commit 07445fea95754b79814fb65259d71bf0ef0c3be7
Author: Eric Dumazet <edumazet@google.com>
Date:   Wed Apr 24 08:04:05 2019 -0700

    ipv4: add sanity checks in ipv4_link_failure()
    
    [ Upstream commit 20ff83f10f113c88d0bb74589389b05250994c16 ]
    
    Before calling __ip_options_compile(), we need to ensure the network
    header is a an IPv4 one, and that it is already pulled in skb->head.
    
    RAW sockets going through a tunnel can end up calling ipv4_link_failure()
    with total garbage in the skb, or arbitrary lengthes.
    
    syzbot report :
    
    BUG: KASAN: stack-out-of-bounds in memcpy include/linux/string.h:355 [inline]
    BUG: KASAN: stack-out-of-bounds in __ip_options_echo+0x294/0x1120 net/ipv4/ip_options.c:123
    Write of size 69 at addr ffff888096abf068 by task syz-executor.4/9204
    
    CPU: 0 PID: 9204 Comm: syz-executor.4 Not tainted 5.1.0-rc5+ #77
    Hardware name: Google Google Compute Engine/Google Compute Engine, BIOS Google 01/01/2011
    Call Trace:
     __dump_stack lib/dump_stack.c:77 [inline]
     dump_stack+0x172/0x1f0 lib/dump_stack.c:113
     print_address_description.cold+0x7c/0x20d mm/kasan/report.c:187
     kasan_report.cold+0x1b/0x40 mm/kasan/report.c:317
     check_memory_region_inline mm/kasan/generic.c:185 [inline]
     check_memory_region+0x123/0x190 mm/kasan/generic.c:191
     memcpy+0x38/0x50 mm/kasan/common.c:133
     memcpy include/linux/string.h:355 [inline]
     __ip_options_echo+0x294/0x1120 net/ipv4/ip_options.c:123
     __icmp_send+0x725/0x1400 net/ipv4/icmp.c:695
     ipv4_link_failure+0x29f/0x550 net/ipv4/route.c:1204
     dst_link_failure include/net/dst.h:427 [inline]
     vti6_xmit net/ipv6/ip6_vti.c:514 [inline]
     vti6_tnl_xmit+0x10d4/0x1c0c net/ipv6/ip6_vti.c:553
     __netdev_start_xmit include/linux/netdevice.h:4414 [inline]
     netdev_start_xmit include/linux/netdevice.h:4423 [inline]
     xmit_one net/core/dev.c:3292 [inline]
     dev_hard_start_xmit+0x1b2/0x980 net/core/dev.c:3308
     __dev_queue_xmit+0x271d/0x3060 net/core/dev.c:3878
     dev_queue_xmit+0x18/0x20 net/core/dev.c:3911
     neigh_direct_output+0x16/0x20 net/core/neighbour.c:1527
     neigh_output include/net/neighbour.h:508 [inline]
     ip_finish_output2+0x949/0x1740 net/ipv4/ip_output.c:229
     ip_finish_output+0x73c/0xd50 net/ipv4/ip_output.c:317
     NF_HOOK_COND include/linux/netfilter.h:278 [inline]
     ip_output+0x21f/0x670 net/ipv4/ip_output.c:405
     dst_output include/net/dst.h:444 [inline]
     NF_HOOK include/linux/netfilter.h:289 [inline]
     raw_send_hdrinc net/ipv4/raw.c:432 [inline]
     raw_sendmsg+0x1d2b/0x2f20 net/ipv4/raw.c:663
     inet_sendmsg+0x147/0x5d0 net/ipv4/af_inet.c:798
     sock_sendmsg_nosec net/socket.c:651 [inline]
     sock_sendmsg+0xdd/0x130 net/socket.c:661
     sock_write_iter+0x27c/0x3e0 net/socket.c:988
     call_write_iter include/linux/fs.h:1866 [inline]
     new_sync_write+0x4c7/0x760 fs/read_write.c:474
     __vfs_write+0xe4/0x110 fs/read_write.c:487
     vfs_write+0x20c/0x580 fs/read_write.c:549
     ksys_write+0x14f/0x2d0 fs/read_write.c:599
     __do_sys_write fs/read_write.c:611 [inline]
     __se_sys_write fs/read_write.c:608 [inline]
     __x64_sys_write+0x73/0xb0 fs/read_write.c:608
     do_syscall_64+0x103/0x610 arch/x86/entry/common.c:290
     entry_SYSCALL_64_after_hwframe+0x49/0xbe
    RIP: 0033:0x458c29
    Code: ad b8 fb ff c3 66 2e 0f 1f 84 00 00 00 00 00 66 90 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 0f 83 7b b8 fb ff c3 66 2e 0f 1f 84 00 00 00 00
    RSP: 002b:00007f293b44bc78 EFLAGS: 00000246 ORIG_RAX: 0000000000000001
    RAX: ffffffffffffffda RBX: 0000000000000003 RCX: 0000000000458c29
    RDX: 0000000000000014 RSI: 00000000200002c0 RDI: 0000000000000003
    RBP: 000000000073bf00 R08: 0000000000000000 R09: 0000000000000000
    R10: 0000000000000000 R11: 0000000000000246 R12: 00007f293b44c6d4
    R13: 00000000004c8623 R14: 00000000004ded68 R15: 00000000ffffffff
    
    The buggy address belongs to the page:
    page:ffffea00025aafc0 count:0 mapcount:0 mapping:0000000000000000 index:0x0
    flags: 0x1fffc0000000000()
    raw: 01fffc0000000000 0000000000000000 ffffffff025a0101 0000000000000000
    raw: 0000000000000000 0000000000000000 00000000ffffffff 0000000000000000
    page dumped because: kasan: bad access detected
    
    Memory state around the buggy address:
     ffff888096abef80: 00 00 00 f2 f2 f2 f2 f2 00 00 00 00 00 00 00 f2
     ffff888096abf000: f2 f2 f2 f2 00 00 00 00 00 00 00 00 00 00 00 00
    >ffff888096abf080: 00 00 f3 f3 f3 f3 00 00 00 00 00 00 00 00 00 00
                             ^
     ffff888096abf100: 00 00 00 00 f1 f1 f1 f1 00 00 f3 f3 00 00 00 00
     ffff888096abf180: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
    
    Fixes: ed0de45a1008 ("ipv4: recompile ip options in ipv4_link_failure")
    Signed-off-by: Eric Dumazet <edumazet@google.com>
    Cc: Stephen Suryaputra <ssuryaextr@gmail.com>
    Acked-by: Willem de Bruijn <willemb@google.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 7ba5ec69e1a7ecfc662050b55e77078208dea9cc
Author: Eric Dumazet <edumazet@google.com>
Date:   Sat Apr 13 17:32:21 2019 -0700

    ipv4: ensure rcu_read_lock() in ipv4_link_failure()
    
    [ Upstream commit c543cb4a5f07e09237ec0fc2c60c9f131b2c79ad ]
    
    fib_compute_spec_dst() needs to be called under rcu protection.
    
    syzbot reported :
    
    WARNING: suspicious RCU usage
    5.1.0-rc4+ #165 Not tainted
    include/linux/inetdevice.h:220 suspicious rcu_dereference_check() usage!
    
    other info that might help us debug this:
    
    rcu_scheduler_active = 2, debug_locks = 1
    1 lock held by swapper/0/0:
     #0: 0000000051b67925 ((&n->timer)){+.-.}, at: lockdep_copy_map include/linux/lockdep.h:170 [inline]
     #0: 0000000051b67925 ((&n->timer)){+.-.}, at: call_timer_fn+0xda/0x720 kernel/time/timer.c:1315
    
    stack backtrace:
    CPU: 0 PID: 0 Comm: swapper/0 Not tainted 5.1.0-rc4+ #165
    Hardware name: Google Google Compute Engine/Google Compute Engine, BIOS Google 01/01/2011
    Call Trace:
     <IRQ>
     __dump_stack lib/dump_stack.c:77 [inline]
     dump_stack+0x172/0x1f0 lib/dump_stack.c:113
     lockdep_rcu_suspicious+0x153/0x15d kernel/locking/lockdep.c:5162
     __in_dev_get_rcu include/linux/inetdevice.h:220 [inline]
     fib_compute_spec_dst+0xbbd/0x1030 net/ipv4/fib_frontend.c:294
     spec_dst_fill net/ipv4/ip_options.c:245 [inline]
     __ip_options_compile+0x15a7/0x1a10 net/ipv4/ip_options.c:343
     ipv4_link_failure+0x172/0x400 net/ipv4/route.c:1195
     dst_link_failure include/net/dst.h:427 [inline]
     arp_error_report+0xd1/0x1c0 net/ipv4/arp.c:297
     neigh_invalidate+0x24b/0x570 net/core/neighbour.c:995
     neigh_timer_handler+0xc35/0xf30 net/core/neighbour.c:1081
     call_timer_fn+0x190/0x720 kernel/time/timer.c:1325
     expire_timers kernel/time/timer.c:1362 [inline]
     __run_timers kernel/time/timer.c:1681 [inline]
     __run_timers kernel/time/timer.c:1649 [inline]
     run_timer_softirq+0x652/0x1700 kernel/time/timer.c:1694
     __do_softirq+0x266/0x95a kernel/softirq.c:293
     invoke_softirq kernel/softirq.c:374 [inline]
     irq_exit+0x180/0x1d0 kernel/softirq.c:414
     exiting_irq arch/x86/include/asm/apic.h:536 [inline]
     smp_apic_timer_interrupt+0x14a/0x570 arch/x86/kernel/apic/apic.c:1062
     apic_timer_interrupt+0xf/0x20 arch/x86/entry/entry_64.S:807
    
    Fixes: ed0de45a1008 ("ipv4: recompile ip options in ipv4_link_failure")
    Signed-off-by: Eric Dumazet <edumazet@google.com>
    Reported-by: syzbot <syzkaller@googlegroups.com>
    Cc: Stephen Suryaputra <ssuryaextr@gmail.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
commit 07445fea95754b79814fb65259d71bf0ef0c3be7
Author: Eric Dumazet <edumazet@google.com>
Date:   Wed Apr 24 08:04:05 2019 -0700

    ipv4: add sanity checks in ipv4_link_failure()
    
    [ Upstream commit 20ff83f10f113c88d0bb74589389b05250994c16 ]
    
    Before calling __ip_options_compile(), we need to ensure the network
    header is a an IPv4 one, and that it is already pulled in skb->head.
    
    RAW sockets going through a tunnel can end up calling ipv4_link_failure()
    with total garbage in the skb, or arbitrary lengthes.
    
    syzbot report :
    
    BUG: KASAN: stack-out-of-bounds in memcpy include/linux/string.h:355 [inline]
    BUG: KASAN: stack-out-of-bounds in __ip_options_echo+0x294/0x1120 net/ipv4/ip_options.c:123
    Write of size 69 at addr ffff888096abf068 by task syz-executor.4/9204
    
    CPU: 0 PID: 9204 Comm: syz-executor.4 Not tainted 5.1.0-rc5+ #77
    Hardware name: Google Google Compute Engine/Google Compute Engine, BIOS Google 01/01/2011
    Call Trace:
     __dump_stack lib/dump_stack.c:77 [inline]
     dump_stack+0x172/0x1f0 lib/dump_stack.c:113
     print_address_description.cold+0x7c/0x20d mm/kasan/report.c:187
     kasan_report.cold+0x1b/0x40 mm/kasan/report.c:317
     check_memory_region_inline mm/kasan/generic.c:185 [inline]
     check_memory_region+0x123/0x190 mm/kasan/generic.c:191
     memcpy+0x38/0x50 mm/kasan/common.c:133
     memcpy include/linux/string.h:355 [inline]
     __ip_options_echo+0x294/0x1120 net/ipv4/ip_options.c:123
     __icmp_send+0x725/0x1400 net/ipv4/icmp.c:695
     ipv4_link_failure+0x29f/0x550 net/ipv4/route.c:1204
     dst_link_failure include/net/dst.h:427 [inline]
     vti6_xmit net/ipv6/ip6_vti.c:514 [inline]
     vti6_tnl_xmit+0x10d4/0x1c0c net/ipv6/ip6_vti.c:553
     __netdev_start_xmit include/linux/netdevice.h:4414 [inline]
     netdev_start_xmit include/linux/netdevice.h:4423 [inline]
     xmit_one net/core/dev.c:3292 [inline]
     dev_hard_start_xmit+0x1b2/0x980 net/core/dev.c:3308
     __dev_queue_xmit+0x271d/0x3060 net/core/dev.c:3878
     dev_queue_xmit+0x18/0x20 net/core/dev.c:3911
     neigh_direct_output+0x16/0x20 net/core/neighbour.c:1527
     neigh_output include/net/neighbour.h:508 [inline]
     ip_finish_output2+0x949/0x1740 net/ipv4/ip_output.c:229
     ip_finish_output+0x73c/0xd50 net/ipv4/ip_output.c:317
     NF_HOOK_COND include/linux/netfilter.h:278 [inline]
     ip_output+0x21f/0x670 net/ipv4/ip_output.c:405
     dst_output include/net/dst.h:444 [inline]
     NF_HOOK include/linux/netfilter.h:289 [inline]
     raw_send_hdrinc net/ipv4/raw.c:432 [inline]
     raw_sendmsg+0x1d2b/0x2f20 net/ipv4/raw.c:663
     inet_sendmsg+0x147/0x5d0 net/ipv4/af_inet.c:798
     sock_sendmsg_nosec net/socket.c:651 [inline]
     sock_sendmsg+0xdd/0x130 net/socket.c:661
     sock_write_iter+0x27c/0x3e0 net/socket.c:988
     call_write_iter include/linux/fs.h:1866 [inline]
     new_sync_write+0x4c7/0x760 fs/read_write.c:474
     __vfs_write+0xe4/0x110 fs/read_write.c:487
     vfs_write+0x20c/0x580 fs/read_write.c:549
     ksys_write+0x14f/0x2d0 fs/read_write.c:599
     __do_sys_write fs/read_write.c:611 [inline]
     __se_sys_write fs/read_write.c:608 [inline]
     __x64_sys_write+0x73/0xb0 fs/read_write.c:608
     do_syscall_64+0x103/0x610 arch/x86/entry/common.c:290
     entry_SYSCALL_64_after_hwframe+0x49/0xbe
    RIP: 0033:0x458c29
    Code: ad b8 fb ff c3 66 2e 0f 1f 84 00 00 00 00 00 66 90 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 0f 83 7b b8 fb ff c3 66 2e 0f 1f 84 00 00 00 00
    RSP: 002b:00007f293b44bc78 EFLAGS: 00000246 ORIG_RAX: 0000000000000001
    RAX: ffffffffffffffda RBX: 0000000000000003 RCX: 0000000000458c29
    RDX: 0000000000000014 RSI: 00000000200002c0 RDI: 0000000000000003
    RBP: 000000000073bf00 R08: 0000000000000000 R09: 0000000000000000
    R10: 0000000000000000 R11: 0000000000000246 R12: 00007f293b44c6d4
    R13: 00000000004c8623 R14: 00000000004ded68 R15: 00000000ffffffff
    
    The buggy address belongs to the page:
    page:ffffea00025aafc0 count:0 mapcount:0 mapping:0000000000000000 index:0x0
    flags: 0x1fffc0000000000()
    raw: 01fffc0000000000 0000000000000000 ffffffff025a0101 0000000000000000
    raw: 0000000000000000 0000000000000000 00000000ffffffff 0000000000000000
    page dumped because: kasan: bad access detected
    
    Memory state around the buggy address:
     ffff888096abef80: 00 00 00 f2 f2 f2 f2 f2 00 00 00 00 00 00 00 f2
     ffff888096abf000: f2 f2 f2 f2 00 00 00 00 00 00 00 00 00 00 00 00
    >ffff888096abf080: 00 00 f3 f3 f3 f3 00 00 00 00 00 00 00 00 00 00
                             ^
     ffff888096abf100: 00 00 00 00 f1 f1 f1 f1 00 00 f3 f3 00 00 00 00
     ffff888096abf180: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
    
    Fixes: ed0de45a1008 ("ipv4: recompile ip options in ipv4_link_failure")
    Signed-off-by: Eric Dumazet <edumazet@google.com>
    Cc: Stephen Suryaputra <ssuryaextr@gmail.com>
    Acked-by: Willem de Bruijn <willemb@google.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
checking b82df42059fb90862505eb071dd0dd225a2791df ......
	 orig commit -> 813dbeb656d6c90266f251d8bd2b02d445afa63f ......
checking 242e5746cb477bdb4c59d0f2d3c5a3e1c0a10629 ......
	 orig commit -> d1841533e54876f152a30ac398a34f47ad6590b1 ......
checking a60a47206a31b92af27ca65b66089b21c5b66d78 ......
	 orig commit -> 43c2adb9df7ddd6560fd3546d925b42cef92daa0 ......
checking 6728c6174a47b8a04ceec89aca9e1195dee7ff6b ......
	 orig commit -> 50ce163a72d817a99e8974222dcf2886d5deb1ae ......
checking 1cd8788368226016b70af2c1e7d46c1bdb4756c6 ......
	 orig commit -> 988dc4a9a3b66be75b30405a5494faf0dc7cffb6 ......
checking 2804598764f984a8c5cdee377a73e0bf86dc5dd4 ......
	 orig commit -> d85e8be2a5a02869f815dd0ac2d743deb4cd7957 ......
checking 97fd88e04c8d724301839129b63ef663e9397a65 ......
	 orig commit -> c5b493ce192bd7a4e7bd073b5685aad121eeef82 ......
checking 08b0b4f28008ae81fa8fdf06d679a9edd6005d88 ......
	 orig commit -> 3b2e2904deb314cc77a2192f506f2fd44e3d10d0 ......
checking bcb964012d1b17544f80a096bb4d6f8cfd32357b ......
	 orig commit -> 899537b73557aafbdd11050b501cf54b4f5c45af ......
checking fae6053d761122b272bdd5bca81561d7da306812 ......
	 orig commit -> 8065a779f17e94536a1c4dcee4f9d88011672f97 ......
checking 2a458eddc4c270a435c26f0d22c46da36cbf00d2 ......
	 orig commit -> 92480b3977fd3884649d404cbbaf839b70035699 ......
