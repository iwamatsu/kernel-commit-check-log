Check from v4.4.53 to v4.4.54
Commit count: 37
checking 804a935963a91acd1764ba914f825dd2a29c5871 ......
checking 4cdfa660c82b57828ffcca94950eccc9458e18e4 ......
	 orig commit -> 372b1e91343e657a7cc5e2e2bcecd5140ac28119 ......
checking 8353f338def1df3b58150cf1d6f42d1a51902b55 ......
	 orig commit -> c0d0e351285161a515396b7b1ee53ec9ffd97e3c ......
checking 13ef90e1bb7963ec2fb9d3680fe418a4b7dedfa3 ......
	 orig commit -> d24cdcd3e40a6825135498e11c20c7976b9bf545 ......
checking 7952b6490bbce45e078c8c0e669df7a0a8f8948a ......
	 orig commit -> bb98e72adaf9d19719aba35f802d4836f5d5176c ......
checking 77fec8bc7a0fbee3bf5893d8c1ce755c029f2b40 ......
	 orig commit -> bdca1fd9a6df745857e23c6056494b7fe062b4e6 ......
checking bb5b96344ed378a1d5b8cf3bd149bb86919f3b9f ......
	 orig commit -> f9ad86e42d0303eeb8e0d41bb208153022ebd9d2 ......
checking 59fc34fc69066bfabf8bed21f4ce5bf312e68bb3 ......
	 orig commit -> 239ac65fa5ffab71adf66e642750f940e7241d99 ......
checking 36fd36b900b9382af54a1e49a81cd99663b83eda ......
	 orig commit -> 36fc579761b50784b63dafd0f2e796b659e0f5ee ......
checking b9cfd5517b309513e50d80b89eaae98a82a2c3b1 ......
	 orig commit -> 3856081eede297b617560b85e948cfb00bb395ec ......
checking 93eab4f5259485e9cad0339a298b6da1dd2e6e40 ......
	 orig commit -> 9bb92f51558f2ef5f56c257bdcea0588f31d857e ......
checking 8b787652386e26c7974092f11bd477126b0d53ce ......
	 orig commit -> 905f21a49d388de3e99438235f3301cabf0c0ef4 ......
checking 0d80ac62b609bce00b78a656b7cdde2d8f587345 ......
	 orig commit -> 4ce3bd45b351633f2a0512c587f7fcba2ce044e8 ......
checking 8650af261d6c119062da542c70881653db0a0b20 ......
	 orig commit -> a9e9200d8661c1a0be8c39f93deb383dc940de35 ......
checking 21096328c97e707f2190b26a06d8b805551a543d ......
	 orig commit -> 4ab18701c66552944188dbcd0ce0012729baab84 ......
checking 6ef213d6219456ea5e4df7d201b4a3384e06783b ......
	 orig commit -> 8d254a340efb12b40c4c1ff25a48a4f48f7bbd6b ......
checking e1c924e85a937de5e1d0dd6c47f094b089952e0c ......
	 orig commit -> 251af29c320d86071664f02c76f0d063a19fefdf ......
checking ca739e3fd7dc803d526ea5bb9b80c0d07fbca55f ......
	 orig commit -> bd4e2d2907fa23a11d46217064ecf80470ddae10 ......
checking 05a9143edb47e7799f191f1015f56eb2dacfee0d ......
	 orig commit -> df963ea8a082d31521a120e8e31a29ad8a1dc215 ......
checking 485171b1ee8c7cc74cff9881b92b178b1c709663 ......
	 orig commit -> 32677207dcc5e594254b7fb4fb2352b1755b1d5b ......
checking 696255449b89af5487bce53b1a65eddedc72aeff ......
	 orig commit -> 0a6fdbdeb1c25e31763c1fb333fa2723a7d2aba6 ......
checking 944690cdb5f48d03842365b7359fe090d6c2b1fa ......
	 orig commit -> 6cb72bc1b40bb2c1750ee7a5ebade93bed49a5fb ......
checking bb4a21dcb6fb57892eea7c941fdfd57e55ba5dbe ......
	 orig commit -> 2b0841766a898aba84630fb723989a77a9d3b4e6 ......
checking 10beca53745eff651209fbd6d8ddbbc0f46c30a4 ......
	 orig commit -> 0a0007f28304cb9fc87809c86abb80ec71317f20 ......
checking 839d42687dfce0ed0ea2c6bd8d707cc0e276fbe7 ......
	 orig commit -> 1064f874abc0d05eeed8993815f584d847b72486 ......
		 1064f874abc0d05eeed8993815f584d847b72486 has problem. Fixes commit -> 570487d3faf2a1d8a220e6ee10f472163123d7da
commit 7cbc3955ef3b5bda9336654f1b10a803202e7ed0
Author: Eric W. Biederman <ebiederm@xmission.com>
Date:   Mon May 15 14:42:07 2017 -0500

    mnt: In umount propagation reparent in a separate pass
    
    commit 570487d3faf2a1d8a220e6ee10f472163123d7da upstream.
    
    It was observed that in some pathlogical cases that the current code
    does not unmount everything it should.  After investigation it
    was determined that the issue is that mnt_change_mntpoint can
    can change which mounts are available to be unmounted during mount
    propagation which is wrong.
    
    The trivial reproducer is:
    $ cat ./pathological.sh
    
    mount -t tmpfs test-base /mnt
    cd /mnt
    mkdir 1 2 1/1
    mount --bind 1 1
    mount --make-shared 1
    mount --bind 1 2
    mount --bind 1/1 1/1
    mount --bind 1/1 1/1
    echo
    grep test-base /proc/self/mountinfo
    umount 1/1
    echo
    grep test-base /proc/self/mountinfo
    
    $ unshare -Urm ./pathological.sh
    
    The expected output looks like:
    46 31 0:25 / /mnt rw,relatime - tmpfs test-base rw,uid=1000,gid=1000
    47 46 0:25 /1 /mnt/1 rw,relatime shared:1 - tmpfs test-base rw,uid=1000,gid=1000
    48 46 0:25 /1 /mnt/2 rw,relatime shared:1 - tmpfs test-base rw,uid=1000,gid=1000
    49 54 0:25 /1/1 /mnt/1/1 rw,relatime shared:1 - tmpfs test-base rw,uid=1000,gid=1000
    50 53 0:25 /1/1 /mnt/2/1 rw,relatime shared:1 - tmpfs test-base rw,uid=1000,gid=1000
    51 49 0:25 /1/1 /mnt/1/1 rw,relatime shared:1 - tmpfs test-base rw,uid=1000,gid=1000
    54 47 0:25 /1/1 /mnt/1/1 rw,relatime shared:1 - tmpfs test-base rw,uid=1000,gid=1000
    53 48 0:25 /1/1 /mnt/2/1 rw,relatime shared:1 - tmpfs test-base rw,uid=1000,gid=1000
    52 50 0:25 /1/1 /mnt/2/1 rw,relatime shared:1 - tmpfs test-base rw,uid=1000,gid=1000
    
    46 31 0:25 / /mnt rw,relatime - tmpfs test-base rw,uid=1000,gid=1000
    47 46 0:25 /1 /mnt/1 rw,relatime shared:1 - tmpfs test-base rw,uid=1000,gid=1000
    48 46 0:25 /1 /mnt/2 rw,relatime shared:1 - tmpfs test-base rw,uid=1000,gid=1000
    
    The output without the fix looks like:
    46 31 0:25 / /mnt rw,relatime - tmpfs test-base rw,uid=1000,gid=1000
    47 46 0:25 /1 /mnt/1 rw,relatime shared:1 - tmpfs test-base rw,uid=1000,gid=1000
    48 46 0:25 /1 /mnt/2 rw,relatime shared:1 - tmpfs test-base rw,uid=1000,gid=1000
    49 54 0:25 /1/1 /mnt/1/1 rw,relatime shared:1 - tmpfs test-base rw,uid=1000,gid=1000
    50 53 0:25 /1/1 /mnt/2/1 rw,relatime shared:1 - tmpfs test-base rw,uid=1000,gid=1000
    51 49 0:25 /1/1 /mnt/1/1 rw,relatime shared:1 - tmpfs test-base rw,uid=1000,gid=1000
    54 47 0:25 /1/1 /mnt/1/1 rw,relatime shared:1 - tmpfs test-base rw,uid=1000,gid=1000
    53 48 0:25 /1/1 /mnt/2/1 rw,relatime shared:1 - tmpfs test-base rw,uid=1000,gid=1000
    52 50 0:25 /1/1 /mnt/2/1 rw,relatime shared:1 - tmpfs test-base rw,uid=1000,gid=1000
    
    46 31 0:25 / /mnt rw,relatime - tmpfs test-base rw,uid=1000,gid=1000
    47 46 0:25 /1 /mnt/1 rw,relatime shared:1 - tmpfs test-base rw,uid=1000,gid=1000
    48 46 0:25 /1 /mnt/2 rw,relatime shared:1 - tmpfs test-base rw,uid=1000,gid=1000
    52 48 0:25 /1/1 /mnt/2/1 rw,relatime shared:1 - tmpfs test-base rw,uid=1000,gid=1000
    
    That last mount in the output was in the propgation tree to be unmounted but
    was missed because the mnt_change_mountpoint changed it's parent before the walk
    through the mount propagation tree observed it.
    
    Fixes: 1064f874abc0 ("mnt: Tuck mounts under others instead of creating shadow/side mounts.")
    Acked-by: Andrei Vagin <avagin@virtuozzo.com>
    Reviewed-by: Ram Pai <linuxram@us.ibm.com>
    Signed-off-by: "Eric W. Biederman" <ebiederm@xmission.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
checking b57ffb2a8466a7628b316c8e3a5ce34b8ee4e519 ......
	 orig commit -> 239a3b663647869330955ec59caac0100ef9b60a ......
checking 376a12eb7f608fad96b13fab3f151eb4c9b40c7c ......
	 orig commit -> 4920e3cf77347d7d7373552d4839e8d832321313 ......
checking 296f7bd7f1dbd2379489ea779779ef437d9e6c6f ......
	 orig commit -> da8fd820f389a0e29080b14c61bf5cf1d8ef5ca1 ......
checking 9cf431dbd8f78d4e78d4aa3ef4fb453cd71e2978 ......
	 orig commit -> fb94a687d96c570d46332a4a890f1dcb7310e643 ......
checking 792bd1fb5b0338232e47412bce2a9b6f0f1fbdaf ......
	 orig commit -> a63f53e34db8b49675448d03ae324f6c5bc04fe6 ......
checking ec50c80c780152d2058c23d9e246fc81f73742da ......
	 orig commit -> 1e4a382fdc0ba8d1a85b758c0811de3a3631085e ......
checking 00cfdbf5ab6e3285bb4589e6e5d241c8db8cd3ed ......
	 orig commit -> 441ad62d6c3f131f1dbd7dcdd9cbe3f74dbd8501 ......
checking cae929bd8d807457997bec4e9fbc61885cc582f7 ......
	 orig commit -> 96794e4ed4d758272c486e1529e431efb7045265 ......
checking 0a3df0418d90d7be1abf8e41191c3caa26f2ad4e ......
	 orig commit -> e1e8a9624f7ba8ead4f056ff558ed070e86fa747 ......
checking 4b34572e98f1b0d0df4ea084347b89b5a20fbede ......
	 orig commit -> 1c9c858e2ff8ae8024a3d75d2ed080063af43754 ......
checking 999853d941b99ca2ac4a331552c388e2603a9b1d ......
	 orig commit -> 82f2341c94d270421f383641b7cd670e474db56b ......
	 orig commit -> be10eb7589337e5defbe214dae038a53dd21add8 ......
checking 59c4d7838e3e526f3e253c536727e3539321fbd6 ......
	 orig commit -> e9b736d88af1a143530565929390cadf036dc799 ......
